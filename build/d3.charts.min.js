(null===d3.charts||"object"!=typeof d3.charts)&&(d3.charts={}),this.d3.charts.barchart=function(){"use strict";function a(a){var g=(b-e.left-e.right,c-e.top-e.bottom),h=d3.scale.ordinal().rangeRoundBands([0,b],.1),i=d3.scale.ordinal(),j=d3.scale.linear().range([g,0]),k=d3.svg.axis().scale(h).orient("bottom"),l=d3.svg.axis().scale(j).orient("left").tickFormat(d3.format(".2s"));d=d3.select("body").append("svg").attr("width",b+e.left+e.right).attr("height",c+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")"),a.each(function(a){var c=d3.keys(a[0]).filter(function(a){return"xAxis"!==a&&"yAxis"!==a&&"target"!==a});a.forEach(function(a){a.group=c.map(function(b){return{name:b,value:+a[b]}})}),h.domain(a.map(function(a){return a.xAxis})),i.domain(c).rangeRoundBands([0,h.rangeBand()]);var e=d3.min(a,function(a){return d3.min(a.group,function(a){return a.value})});e>0&&(e=0);var m=d3.max(a,function(a){return d3.max(a.group,function(a){return a.value})}),n=Number(a[0].target);n>m&&(m=n),j.domain([e,m]);var o=g;0>e&&m>0&&(o=g*(m/(m-e)));var p=d.selectAll(".cat").data(a).enter().append("g").attr("class","g").attr("transform",function(a){return"translate("+h(a.xAxis)+",0)"});p.selectAll("rect").data(function(a){return a.group}).enter().append("rect").attr("width",i.rangeBand()).attr("x",function(a){return i(a.name)}).attr("y",function(a){return a.value<0?j(0):j(a.value)}).attr("height",function(a){return a.value<0?j(a.value+m):g-j(a.value+e)}).style("fill",function(a){return f(a.name)}),d.append("g").attr("class","y axis").attr("transform","translate(0,"+o+")").call(k),d.append("g").attr("class","y axis").call(l).append("text").attr("y",-20).attr("dy",".71em").style("text-anchor","start").text(a[0].yAxis),d.append("line").attr("x1",0).attr("y1",j(n)).attr("x2",b).attr("y2",j(n)).attr("style",function(){return"fill:none;stroke-dasharray:5,5;stroke:gray;stroke-width:2;"})})}var b=1500,c=500,d={},e={top:20,right:100,bottom:10,left:250},f=d3.scale.category20();return a.width=function(c){return arguments.length?(b=c,a):b},a.height=function(b){return arguments.length?(c=b,a):c},a.svg=function(){return d},a},(null===d3.charts||"object"!=typeof d3.charts)&&(d3.charts={}),this.d3.charts.heatmap=function(){"use strict";function a(a){var h=b-f.left-f.right,i=c-f.top-f.bottom,j=d,k=function(a,b){var c=g(b,"xAxis"),d=g(b,"yAxis"),e=d3.scale.ordinal().domain(c).rangeRoundBands([0,h],.2,.2),f=d3.scale.ordinal().domain(d).rangeRoundBands([0,i],.2,.2),j=d3.svg.axis().scale(f).orient("left"),k=d3.svg.axis().scale(e).orient("top"),l=a.selectAll("g.heatmap rect").data(b);l.enter().append("rect").attr("style",function(a){return"fill:"+a.color+";stroke:gray;stroke-width:2;fill-opacity:.75;stroke-opacity:0.9"}),l.attr("x",function(a){return e(a.xAxis)}).attr("y",function(a){return f(a.yAxis)}).attr("rx",10).attr("ry",10).attr("width",e.rangeBand()).attr("height",f.rangeBand()).transition().style("fill",function(a){return a.color}),l.exit().remove();var m=a.selectAll("g.heatmap .cell.value").data(b);m.enter().append("text"),m.attr("text-anchor","middle").attr("x",function(a){return e(a.xAxis)}).attr("y",function(a){return f(a.yAxis)}).attr("dy",function(){return f.rangeBand()/2}).attr("dx",function(){return e.rangeBand()/2}).attr("class","cell value").text(function(a){return Number(a.value).toFixed(2)}),m.exit().remove(),a.selectAll(".x.axis").data(c).enter().append("g").attr("class","x axis"),a.select(".x.axis").transition().call(k),a.selectAll(".y.axis").data(c).enter().append("g").attr("class","y axis"),a.select(".y.axis").transition().call(j)};a.each(function(a){var d=g(a,"name"),l=d3.scale.ordinal().domain(d).rangeRoundBands([0,h],.2,.2),m=d3.scale.quantize().domain([0,h]).range(d),n=d3.svg.axis().scale(l).orient("top").tickSize([0]);e=d3.select(this).append("svg").attr("width",h+f.left+f.right).attr("height",i+f.top+f.bottom);var o=e.append("g").attr("class","heatmap").attr("transform","translate("+f.left+","+f.top+")"),p=function(){if(d3.event.sourceEvent){var b=m(q.extent()[0]),c=l(b),d=c+l.rangeBand(),e=_.find(a,function(a){return a.name==b}).data;k(o,e),d3.select(this).transition().call(q.extent([c,d])).call(q.event)}},q=d3.svg.brush().x(l).on("brushend",p);e.append("rect").attr("height",c).attr("width",b).attr("style","stroke:gray;stroke-width:2;fill-opacity:0.05;stroke-opacity:0.9; fill:white"),k(o,a[0].data);var r=e.append("g").attr("transform","translate("+f.left+","+40+")");r.append("rect").attr("height",j).attr("width",h).attr("style","stroke:gray;stroke-width:2;fill-opacity:0.2;stroke-opacity:0.3; fill:gray"),r.append("g").attr("class","x axis").attr("transform","translate(0,"+.66*j+")").call(n),r.append("g").attr("class","x brush").call(q).call(q.event).selectAll("rect").attr("y",0).attr("height",j)})}var b=1960,c=500,d=50,e={},f={top:140,right:10,bottom:10,left:175},g=function(a,b){return _.reduce(a,function(a,c){return a.filter(function(a){return c[b]===a}).length||a.push(c[b]),a},[])};return a.width=function(c){return arguments.length?(b=c,a):b},a.height=function(b){return arguments.length?(c=b,a):c},a.svg=function(){return e},a},(null===d3.charts||"object"!=typeof d3.charts)&&(d3.charts={}),this.d3.charts.timeseries=function(){"use strict";function a(a){var h=b-e.left-e.right,i=c-e.top-e.bottom,j=d,k=d3.time.scale().range([0,h]),l=d3.time.scale().range([0,h]),m=d3.scale.linear().range([i,0]),n=d3.scale.linear().range([j,0]),o=d3.svg.axis().scale(k).orient("bottom"),p=d3.svg.axis().scale(l).orient("bottom"),q=d3.svg.axis().scale(m).orient("left");a.each(function(a){g.domain(_.map(a,function(a){return a.series})),k.domain(d3.extent(a[0].data,function(a){return a.date})),m.domain([d3.min(a,function(a){return d3.min(a.data,function(a){return a.value})}),d3.max(a,function(a){return d3.max(a.data,function(a){return a.value})})]),l.domain(k.domain()),n.domain(m.domain());var b=d3.svg.line().interpolate("basis").x(function(a){return k(a.date)}).y(function(a){return m(a.value)}),c=d3.svg.line().interpolate("basis").x(function(a){return l(a.date)}).y(function(a){return n(a.value)});f=d3.select(this).append("svg").attr("width",h+e.left+e.right).attr("height",i+e.top+e.bottom),f.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",h).attr("height",i);var d=f.append("g").attr("transform","translate("+e.left+","+e.top+")"),r=d3.svg.brush().x(l).on("brush",function(){k.domain(r.empty()?l.domain():r.extent()),d.selectAll("path").data(a).attr("d",function(a){return b(a.data)}),d.select(".x.axis").call(o)}),s=f.append("g").attr("transform","translate("+e.left+","+(i+j-e.top)+")");d.selectAll("path").data(a).enter().append("path").attr("clip-path","url(#clip)").attr("class","line").attr("fill","none").attr("d",function(a){return b(a.data)}).attr("stroke",function(a){return g(a.series)}),d.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(o),d.append("g").attr("class","y axis").call(q),s.selectAll("path").data(a).enter().append("path").attr("class","line").attr("fill","none").attr("d",function(a){return c(a.data)}).attr("stroke",function(a){return g(a.series)}),s.append("g").attr("class","x axis").attr("transform","translate(0,"+j+")").call(p),s.append("g").attr("class","x brush").call(r).selectAll("rect").attr("y",-6).attr("height",j+7),console.log(f)})}var b=960,c=500,d=50,e={top:10,right:10,bottom:100,left:40},f={},g=d3.scale.category10();return a.width=function(c){return arguments.length?(b=c,a):b},a.height=function(b){return arguments.length?(c=b,a):c},a.svg=function(){return f},a};