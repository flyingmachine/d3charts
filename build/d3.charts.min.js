(null===d3.charts||"object"!=typeof d3.charts)&&(d3.charts={}),this.d3.charts.barchart=function(){"use strict";function a(a){var f,g=function(){return"undefined"!=typeof f},h=(b-e.left-e.right,c-e.top-e.bottom),i=d3.scale.ordinal().rangeRoundBands([0,b],.3),j=d3.scale.ordinal(),k=d3.scale.linear().range([h,0]),l=d3.svg.axis().scale(i).orient("bottom"),m=d3.svg.axis().scale(k).orient("left");a.each(function(a){var n=d3.keys(a[0]).filter(function(a){return"xAxis"!==a&&"yAxis"!==a&&"target"!==a&&"group"!==a});d=d3.select(this).append("svg").attr("class","barchart").attr("width",b+e.left+e.right).attr("height",c+e.top+e.bottom);var o=d.append("g").attr("transform","translate("+e.left+","+e.top+")");a.forEach(function(a){a.group=n.map(function(b){return{name:b,value:+a[b].value,color:a[b].color}})}),i.domain(a.map(function(a){return a.xAxis})),j.domain(n).rangeRoundBands([0,i.rangeBand()]);var p=d3.min(a,function(a){return d3.min(a.group,function(a){return a.value})});p>0&&(p=0);var q=d3.max(a,function(a){return d3.max(a.group,function(a){return a.value})});"undefined"!=typeof a[0].target&&(f=Number(a[0].target)),g()&&f>q&&(q=f),k.domain([p,q]);var r=h;0>p&&q>0&&(r=h*(q/(q-p)));var s=o.selectAll(".cat").data(a).enter().append("g").attr("class","g").attr("transform",function(a){return"translate("+i(a.xAxis)+",0)"});s.selectAll("rect").data(function(a){return a.group}).enter().append("rect").attr("width",j.rangeBand()).attr("x",function(a){return j(a.name)}).attr("y",function(a){return a.value<0?k(0):k(a.value)}).attr("height",function(a){return a.value<0?k(a.value+q):h-k(a.value+p)}).style("fill",function(a){return a.color}),o.append("g").attr("class","x axis").attr("transform","translate(0,"+r+")").call(l),o.append("svg:g").attr("class","y axis").call(m).selectAll("g").append("svg:foreignObject").attr("width","150px").attr("height","40px").attr("x",-160).attr("y",-20).attr("style","text-align: right;").append("xhtml:div").html(function(a){return a}),o.selectAll(".y.axis g text").remove(),o.select(".y.axis").append("text").attr("y",-20).style("text-anchor","start").text(a[0].yAxis),g()&&o.append("line").attr("class","target").attr("x1",0).attr("y1",k(f)).attr("x2",b).attr("y2",k(f))})}var b=1200,c=400,d={},e={top:50,right:20,bottom:0,left:75};return a.width=function(c){return arguments.length?(b=c,a):b},a.height=function(b){return arguments.length?(c=b,a):c},a.svg=function(){return d},a},(null===d3.charts||"object"!=typeof d3.charts)&&(d3.charts={}),this.d3.charts.donut=function(){"use strict";function a(a){b-e.left-e.right,c-e.top-e.bottom,a.each(function(a){var b=960,c=500,d=Math.min(b,c)/2,e=d3.scale.ordinal().range(["#98abc5","#8a89a6","#7b6888","#6b486b","#a05d56","#d0743c","#ff8c00"]),f=d3.svg.arc().outerRadius(d-10).innerRadius(d-70),g=d3.layout.pie().sort(null).value(function(a){return a.population}),h=d3.select("body").append("svg").attr("width",b).attr("height",c).append("g").attr("transform","translate("+b/2+","+c/2+")"),i=h.selectAll(".arc").data(g(a)).enter().append("g").attr("class","arc");i.append("path").attr("d",function(){}).style("fill",function(a){return e(a.data.age)}),i.append("text").attr("transform",function(a){return"translate("+f.centroid(a)+")"}).attr("dy",".35em").style("text-anchor","middle").text(function(a){return a.data.age})})}var b=960,c=500,d={},e={top:40,right:10,bottom:20,left:100};return a.width=function(c){return arguments.length?(b=c,a):b},a.height=function(b){return arguments.length?(c=b,a):c},a.svg=function(){return d},a},(null===d3.charts||"object"!=typeof d3.charts)&&(d3.charts={}),this.d3.charts.filter=function(){"use strict";function a(a){a.each(function(a){a.unshift("pick something"),d=d3.select(this).append("div");var b=d.append("select"),c=b.selectAll("option").data(a);c.enter().append("option").attr("value",function(a){return a}).attr("subcategory",function(a){return a}).text(function(a){return a})})}var b=960,c=500,d={};return a.width=function(c){return arguments.length?(b=c,a):b},a.height=function(b){return arguments.length?(c=b,a):c},a.svg=function(){return d},a},(null===d3.charts||"object"!=typeof d3.charts)&&(d3.charts={}),this.d3.charts.groupStack=function(){"use strict";function a(a){var f=b-e.left-e.right,g=c-e.top-e.bottom;a.each(function(a){var c=d3.layout.stack(),h=c(a),i=_.map(h[0],function(a){return a.x}),j=d3.max(h,function(a){return d3.max(a,function(a){return a.y0+a.y})}),k=d3.scale.ordinal().domain(i).rangeRoundBands([0,g],.08),l=d3.scale.linear().domain([0,j]).range([0,f]),m=d3.scale.linear().domain([0,h.length-1]).range(["#a8c1e5","#2563bf"]),n=d3.svg.axis().scale(l).tickSize(0).tickPadding(6).orient("bottom"),o=d3.svg.axis().scale(k).tickSize(0).tickPadding(6).orient("left");d=d3.select(this).append("svg").attr("class","groupStack").attr("width",f+e.left+e.right).attr("height",g+e.top+e.bottom);var p=d.append("g").attr("transform","translate("+e.left+","+e.top+")").attr("class","groupStack"),q=p.selectAll(".layer").data(h).enter().append("g").attr("class","layer").style("fill",function(a,b){return m(b)}),r=q.selectAll("rect").data(function(a){return a}).enter().append("rect").attr("x",0).attr("y",function(a){return k(a.x)}).attr("width",0).attr("height",k.rangeBand());r.transition().delay(function(a,b){return 10*b}).attr("x",function(a){return l(a.y0)}).attr("width",function(a){return l(a.y)}),p.append("g").attr("class","x axis").attr("transform","translate(0,"+g+")").call(n),p.append("g").attr("class","y axis").call(o),q.selectAll("text").data(function(a){return a}).enter().append("text").attr("x",function(a){return l(a.y)+5}).attr("y",function(a){return k(a.y)+k.rangeBand()/2+4}).attr("class","value").text(function(a){return a.y+a.y0});var s=d.selectAll(".legend").data(h).enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate(0,"+20*b+")"});s.append("rect").attr("x",b-18).attr("width",18).attr("height",18).style("fill",function(a,b){return m(b)}),s.append("text").attr("x",b-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(a,b){return a[b].category})})}var b=960,c=500,d={},e={top:40,right:10,bottom:20,left:200};return a.width=function(c){return arguments.length?(b=c,a):b},a.height=function(b){return arguments.length?(c=b,a):c},a.svg=function(){return d},a},(null===d3.charts||"object"!=typeof d3.charts)&&(d3.charts={}),this.d3.charts.heatmap=function(){"use strict";function a(a){var g=b-f.left-f.right,h=c-f.top-f.bottom,i=d,j=d3.scale.ordinal().rangeRoundBands([0,g],0,0),k=d3.scale.ordinal().rangeRoundBands([0,g],.2,.2),l=d3.scale.ordinal().rangeRoundBands([0,h],0,0),m=d3.svg.axis().scale(l).orient("left"),n=d3.svg.axis().scale(j).orient("top"),o=d3.svg.axis().scale(k).orient("top").tickSize([0]),p=d3.scale.quantize().domain([0,g]),q=d3.svg.brush().x(k),r=function(a){a.select(".y.axis").selectAll("g").append("svg:foreignObject").attr("width","150px").attr("height","40px").attr("class","htmlaxis").attr("x",-160).attr("y",-20).attr("style","text-align: right;").append("xhtml:div").html(function(a){return a}),a.selectAll(".y.axis g text").remove()},s=function(a,b){j.domain(d3.utilities.uniqueProperties(b,"xAxis")),l.domain(d3.utilities.uniqueProperties(b,"yAxis"));var c=a.selectAll("g.heatmap .square").data(b);c.enter().append("rect").attr("class","square").attr("style",function(a){return"fill:"+a.color}),c.attr("x",function(a){return j(a.xAxis)}).attr("y",function(a){return l(a.yAxis)}).attr("rx",0).attr("ry",0).attr("width",j.rangeBand()).attr("height",l.rangeBand()).transition().style("fill",function(a){return a.color}),c.exit().remove();var d=a.selectAll("g.heatmap .cell.value").data(b);d.enter().append("text"),d.attr("text-anchor","middle").attr("x",function(a){return j(a.xAxis)}).attr("y",function(a){return l(a.yAxis)}).attr("dy",function(){return l.rangeBand()/2+4}).attr("dx",function(){return j.rangeBand()/2}).attr("class","cell value").text(function(a){return a.value}),d.exit().remove(),a.selectAll(".y.axis g .htmlaxis").remove(),a.select(".y.axis").transition().call(m),a.select(".x.axis").transition().call(n),r(a)},t=function(a,b){var c=a.append("g").attr("class","timeline").attr("transform","translate("+f.left+","+40+")");c.append("rect").attr("height",i).attr("width",g),c.append("g").attr("class","x axis").attr("transform","translate(0,"+.66*i+")").call(o),c.append("g").attr("class","x brush").call(b).call(b.event).selectAll("rect").attr("y",0).attr("height",i)},u=function(a,b){var c=a.selectAll("category").data([b]);c.enter().append("category"),c.text(function(a){return a})};a.each(function(a){var b=function(){var b=p(q.extent()[0]),c=k(b),e=c+k.rangeBand(),f=_.find(a,function(a){return a.name==b}).data;s(d,f),u(i,b),d3.select(this).transition().call(q.extent([c,e]))},c=d3.utilities.uniqueProperties(a,"name");k.domain(d3.utilities.uniqueProperties(a,"name")),p.range(c),q.on("brushend",b),e=d3.select(this).append("svg").attr("class","heatmap").attr("width",g+f.left+f.right).attr("height",h+f.top+f.bottom);var d=e.append("g").attr("class","heatmap").attr("transform","translate("+f.left+","+f.top+")"),i=e.append("meta-data");d.append("g").attr("class","x axis").call(n),d.append("g").attr("class","y axis").call(m),r(d),s(d,a[0].data),c.length>1&&t(e,q),b()})}var b=960,c=400,d=50,e={},f={top:140,right:10,bottom:10,left:200};return a.width=function(c){return arguments.length?(b=c,a):b},a.height=function(b){return arguments.length?(c=b,a):c},a.svg=function(){return e},a},(null===d3.charts||"object"!=typeof d3.charts)&&(d3.charts={}),this.d3.charts.timeseries=function(){"use strict";function a(a){var i,j=function(){return"undefined"!=typeof i},k=function(a,b,c){return c/a*b},l=b-f.left-f.right,m=c-f.top-f.bottom,n=d,o=d3.time.scale().range([0,l]),p=d3.time.scale().range([0,l]),q=d3.scale.linear().range([m,0]),r=d3.scale.linear().range([n,0]),s=d3.svg.axis().scale(o).orient("bottom"),t=d3.svg.axis().scale(p).orient("bottom"),u=d3.svg.axis().scale(q).orient("left");a.each(function(a){var b=d3.min(a,function(a){return d3.min(a.data,function(a){return a.value})}),c=d3.max(a,function(a){return d3.max(a.data,function(a){return a.value})}),d=k(q.range()[0],c,2*g);o.domain(d3.extent(a[0].data,function(a){return a.date})),q.domain([b-d,c+d]),p.domain(o.domain()),r.domain(q.domain());var v=d3.svg.line().x(function(a){return o(a.date)}).y(function(a){return q(a.value)}),w=d3.svg.line().x(function(a){return p(a.date)}).y(function(a){return r(a.value)});"undefined"!=typeof a[0].data[0].target&&(i=Number(a[0].data[0].target)),h=d3.select(this).append("svg").attr("class","timeseries").attr("width",l+f.left+f.right).attr("height",m+f.top+f.bottom),h.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",l).attr("height",m);var x=h.append("g").attr("class","chart1").attr("transform","translate("+f.left+","+f.top+")"),y=function(){o.domain(z.empty()?p.domain():z.extent()),_.filter(a[0].data,function(a){return a.date>=o.domain()[0]&&a.date<=o.domain()[1]}),x.selectAll("path").data(a).attr("d",function(a){return v(a.data)}),x.selectAll("circle").data(a[0].data).attr("cx",function(a){return o(a.date)}).attr("cy",function(a){return q(a.value)}),x.select(".x.axis").call(s)},z=d3.svg.brush().x(p).on("brush",y),A=h.append("g").attr("class","chart2").attr("transform","translate("+f.left+","+(m+f.top+e)+")");x.append("rect").attr("class","focus").attr("x",0).attr("y",0).attr("width",l).attr("height",m),A.append("rect").attr("class","context").attr("x",0).attr("y",0).attr("width",l).attr("height",n),j()&&x.append("line").attr("class","target").attr("x1",0).attr("y1",q(i)).attr("x2",l).attr("y2",q(i)),x.selectAll("path").data(a).enter().append("path").attr("clip-path","url(#clip)").attr("class","line").attr("d",function(a){return v(a.data)}),x.selectAll("circle").data(a[0].data).enter().append("circle").attr("class","circle").attr("clip-path","url(#clip)").style("stroke",function(a){return a.color}).attr("cx",function(a){return o(a.date)}).attr("cy",function(a){return q(a.value)}).attr("r",g),x.append("g").attr("class","x axis").attr("transform","translate(0,"+m+")").call(s),x.append("svg:g").attr("class","y axis").call(u).selectAll("g").append("svg:foreignObject").attr("width","150px").attr("height","40px").attr("x",-160).attr("y",-20).attr("style","text-align: right;").append("xhtml:div").html(function(a){return a}),x.selectAll(".y.axis g text").remove(),A.selectAll("path").data(a).enter().append("path").attr("class","timeline").attr("d",function(a){return w(a.data)}),A.append("g").attr("class","x axis").attr("transform","translate(0,"+n+")").call(t),p.domain()[0],new Date,z.extent([p.domain()[0],p.domain()[1]]),A.append("g").attr("class","x brush").call(z).selectAll("rect").attr("height",n)})}var b=960,c=500,d=50,e=30,f={top:25,right:10,bottom:100,left:80},g=4,h={};return a.width=function(c){return arguments.length?(b=c,a):b},a.height=function(b){return arguments.length?(c=b,a):c},a.svg=function(){return h},a},(null===d3.utilities||"object"!=typeof d3.utilities)&&(d3.utilities={}),this.d3.utilities={uniqueProperties:function(a,b){return _.reduce(a,function(a,c){return a.filter(function(a){return c[b]===a}).length||a.push(c[b]),a},[])}};